#!/bin/bash

# Size of the rofi window used for the action menu
readonly MENU_HEIGHT=241
readonly MENU_WIDTH=240

lockscreen() {
  if command -v hyprlock >/dev/null 2>&1; then
    hyprlock &
  elif command -v swaylock >/dev/null 2>&1; then
    swaylock -c 000000 &
  else
    notify-send "Error" "No lock application found" \
      "Install 'swaylock' or 'hyprlock'"
  fi
}

to_lower() {
  printf '%s\n' "${1,,}"
}

# Launch menu to select the action
pick_action() {
  local menu_items

  menu_items=(
    "  Poweroff"
    "  Reboot"
    "  Suspend"
    "  Lock"
    "  Hibernate"
  )

  local selection
  selection=$(printf '%s\n' "${menu_items[@]}" |
    rofi -dmenu -theme dmenu \
      -theme-str "window {height: ${MENU_HEIGHT}px;width: ${MENU_WIDTH}px;}" \
      -p 'Action' -no-custom) || exit 1

  local action
  # Remove the icon from the selected option
  action="${selection##* }"
  to_lower "$action"
}

exec_action() {
  local action
  action="$1"
  # Executes the corresponding system command based on the user's selection.
  case "$action" in
  poweroff)
    poweroff
    ;;
  reboot)
    reboot
    ;;
  suspend)
    systemctl suspend
    ;;
  hibernate)
    systemctl hibernate
    ;;
  lock)
    lockscreen
    ;;
  *)
    notify-send "Invalid option"
    exit 1
    ;;
  esac
}

main() {
  action="$(pick_action)" || exit 1

  exec_action "$action"
}

main
